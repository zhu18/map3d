/**
* map3d V1.0.0
* (c) 2018-2020
* Copyright all contributors
* @license Released under ISC license.
*/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("three")):"function"==typeof define&&define.amd?define(["exports","three"],t):t((e=e||self).Map3D={},e.THREE)}(this,function(e,t){"use strict";var o={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(e){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var e=document.createElement("div");return e.id="webgl-error-message",e.style.fontFamily="monospace",e.style.fontSize="13px",e.style.fontWeight="normal",e.style.textAlign="center",e.style.background="#fff",e.style.color="#000",e.style.padding="1.5em",e.style.width="400px",e.style.margin="5em auto 0",this.webgl||(e.innerHTML=window.WebGLRenderingContext?['Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n"):['Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n")),e},addGetWebGLMessage:function(e){var t,n,i;t=void 0!==(e=e||{}).parent?e.parent:document.body,n=void 0!==e.id?e.id:"oldie",(i=o.getWebGLErrorMessage()).id=n,t.appendChild(i)}};void 0===Date.now&&(Date.now=function(){return(new Date).valueOf()});var n,i=i||(n=[],{REVISION:"14",getAll:function(){return n},removeAll:function(){n=[]},add:function(e){n.push(e)},remove:function(e){var t=n.indexOf(e);-1!==t&&n.splice(t,1)},update:function(e){if(0===n.length)return!1;var t=0;for(e=void 0!==e?e:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now();t<n.length;)n[t].update(e)?t++:n.splice(t,1);return!0}});function a(e){return"string"==typeof e&&(e=-1!==e.indexOf("#")?parseInt(e.replace("#",""),16):new t.Color(e).getHex()),e}function s(e,t,o,n,a,s){"number"!=typeof o&&(o=1e3),s||(s=(()=>{})),new i.Tween(e).to(t,o).delay(n||0).easing(a||i.Easing.Linear.None).start().onComplete(s)}i.Tween=function(e){var t=e,o={},n={},a={},s=1e3,r=0,h=!1,l=!1,c=0,u=null,d=i.Easing.Linear.None,m=i.Interpolation.Linear,p=[],f=null,g=!1,v=null,b=null,w=null;for(var y in e)o[y]=parseFloat(e[y],10);this.to=function(e,t){return void 0!==t&&(s=t),n=e,this},this.start=function(e){for(var s in i.add(this),l=!0,g=!1,u=void 0!==e?e:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now(),u+=c,n){if(n[s]instanceof Array){if(0===n[s].length)continue;n[s]=[t[s]].concat(n[s])}o[s]=t[s],o[s]instanceof Array==0&&(o[s]*=1),a[s]=o[s]||0}return this},this.stop=function(){return l?(i.remove(this),l=!1,null!==w&&w.call(t),this.stopChainedTweens(),this):this},this.stopChainedTweens=function(){for(var e=0,t=p.length;t>e;e++)p[e].stop()},this.delay=function(e){return c=e,this},this.repeat=function(e){return r=e,this},this.yoyo=function(e){return h=e,this},this.easing=function(e){return d=e,this},this.interpolation=function(e){return m=e,this},this.chain=function(){return p=arguments,this},this.onStart=function(e){return f=e,this},this.onUpdate=function(e){return v=e,this},this.onComplete=function(e){return b=e,this},this.onStop=function(e){return w=e,this},this.update=function(e){var i;if(u>e)return!0;!1===g&&(null!==f&&f.call(t),g=!0);var l=(e-u)/s,w=d(l=l>1?1:l);for(i in n){var y=o[i]||0,x=n[i];x instanceof Array?t[i]=m(x,w):("string"==typeof x&&(x=y+parseFloat(x,10)),"number"==typeof x&&(t[i]=y+(x-y)*w))}if(null!==v&&v.call(t,w),1==l){if(r>0){for(i in isFinite(r)&&r--,a){if("string"==typeof n[i]&&(a[i]=a[i]+parseFloat(n[i],10)),h){var E=a[i];a[i]=n[i],n[i]=E}o[i]=a[i]}return u=e+c,!0}null!==b&&b.call(t);for(var _=0,D=p.length;D>_;_++)p[_].start(e);return!1}return!0}},i.Easing={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){var t,o=.1;return 0===e?0:1===e?1:(!o||1>o?(o=1,t=.1):t=.4*Math.asin(1/o)/(2*Math.PI),-o*Math.pow(2,10*(e-=1))*Math.sin(2*(e-t)*Math.PI/.4))},Out:function(e){var t,o=.1;return 0===e?0:1===e?1:(!o||1>o?(o=1,t=.1):t=.4*Math.asin(1/o)/(2*Math.PI),o*Math.pow(2,-10*e)*Math.sin(2*(e-t)*Math.PI/.4)+1)},InOut:function(e){var t,o=.1;return 0===e?0:1===e?1:(!o||1>o?(o=1,t=.1):t=.4*Math.asin(1/o)/(2*Math.PI),(e*=2)<1?-.5*o*Math.pow(2,10*(e-=1))*Math.sin(2*(e-t)*Math.PI/.4):o*Math.pow(2,-10*(e-=1))*Math.sin(2*(e-t)*Math.PI/.4)*.5+1)}},Back:{In:function(e){var t=1.70158;return e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?.5*e*e*((t+1)*e-t):.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:function(e){return 1-i.Easing.Bounce.Out(1-e)},Out:function(e){return 1/2.75>e?7.5625*e*e:2/2.75>e?7.5625*(e-=1.5/2.75)*e+.75:2.5/2.75>e?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return.5>e?.5*i.Easing.Bounce.In(2*e):.5*i.Easing.Bounce.Out(2*e-1)+.5}}},i.Interpolation={Linear:function(e,t){var o=e.length-1,n=o*t,a=Math.floor(n),s=i.Interpolation.Utils.Linear;return 0>t?s(e[0],e[1],n):t>1?s(e[o],e[o-1],o-n):s(e[a],e[a+1>o?o:a+1],n-a)},Bezier:function(e,t){var o,n=0,a=e.length-1,s=Math.pow,r=i.Interpolation.Utils.Bernstein;for(o=0;a>=o;o++)n+=s(1-t,a-o)*s(t,o)*e[o]*r(a,o);return n},CatmullRom:function(e,t){var o=e.length-1,n=o*t,a=Math.floor(n),s=i.Interpolation.Utils.CatmullRom;return e[0]===e[o]?(0>t&&(a=Math.floor(n=o*(1+t))),s(e[(a-1+o)%o],e[a],e[(a+1)%o],e[(a+2)%o],n-a)):0>t?e[0]-(s(e[0],e[0],e[1],e[1],-n)-e[0]):t>1?e[o]-(s(e[o],e[o],e[o-1],e[o-1],n-o)-e[o]):s(e[a?a-1:0],e[a],e[a+1>o?o:a+1],e[a+2>o?o:a+2],n-a)},Utils:{Linear:function(e,t,o){return(t-e)*o+e},Bernstein:function(e,t){var o=i.Interpolation.Utils.Factorial;return o(e)/o(t)/o(e-t)},Factorial:function(){var e=[1];return function(t){var o,n=1;if(e[t])return e[t];for(o=t;o>1;o--)n*=o;return e[t]=n}}(),CatmullRom:function(e,t,o,n,i){var a=.5*(o-e),s=.5*(n-t),r=i*i;return(2*t-2*o+a+s)*(i*r)+(-3*t+3*o-2*a-s)*r+a*i+t}}};let r=function(){var e,t=Object.prototype.toString,o=Object.prototype.hasOwnProperty,n={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regExp","[object Object]":"object"},i=function(e){return null==e?String(e):n[t.call(e)]||"object"},a=Array.isArray||function(e){return"array"===i(e)},s=function(e){if(!e||"object"!==i(e)||e.nodeType||function(e){return e&&"object"==typeof e&&"setInterval"in e}(e))return!1;if(e.constructor&&!o.call(e,"constructor")&&!o.call(e.constructor.prototype,"isPrototypeOf"))return!1;var t;for(t in e);return void 0===t||o.call(e,t)},r=function(t,o,n){for(var i in n){var h=o[i],l=n[i];if(o!==l)if(t&&l&&(s(l)||(e=a(l)))){if(e){e=!1;var c=h&&a(h)?h:[]}else c=h&&s(h)?h:{};o[i]=r(t,c,l)}else void 0!==l&&(o[i]=l)}return o};return r}();class h extends t.Object3D{constructor(e,t){super(),this.type="Font3D",this.name=e;var o={size:50,follow:!1,family:"Arial",borderColor:"#000000",color:"#ffffff",style:"oblique",weight:"bold"};Object.assign(o,t),Object.assign(this.userData,o),this._textObj=null,this.getText2D(e,o)}getText2D(e,o){let n=document.createElement("canvas"),i=n.getContext("2d");n.width=512,n.height=512,i.clearRect(0,0,512,512),i.font="100px "+o.family,i.fillStyle=o.color,i.textAlign="center",i.textBaseline="middle",i.fillText(e,256,256),i.strokeStyle=o.borderColor,i.strokeText(e,256,256);var a=new t.Texture(n);if(a.needsUpdate=!0,o.follow){let e=new t.SpriteMaterial({map:a});this._textObj=new t.Sprite(e)}else{let e=new t.MeshBasicMaterial({map:a,color:16777215,transparent:!0,depthTest:!1}),o=new t.PlaneGeometry(1,1,1,1);this._textObj=new t.Mesh(o,e)}this._textObj.scale.set(o.size/10,o.size/10,1),this._textObj.renderOrder=99,this.add(this._textObj)}}function l(e,o){var n,i,a,s,r;this.object=e,this.domElement=void 0!==o?o:document,this.enabled=!0,this.target=new t.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:t.MOUSE.LEFT,ZOOM:t.MOUSE.MIDDLE,PAN:t.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return f.phi},this.getAzimuthalAngle=function(){return f.theta},this.saveState=function(){h.target0.copy(h.target),h.position0.copy(h.object.position),h.zoom0=h.object.zoom},this.reset=function(){h.target.copy(h.target0),h.object.position.copy(h.position0),h.object.zoom=h.zoom0,h.object.updateProjectionMatrix(),h.dispatchEvent(l),h.update(),m=d.NONE},this.update=(n=new t.Vector3,i=(new t.Quaternion).setFromUnitVectors(e.up,new t.Vector3(0,1,0)),a=i.clone().inverse(),s=new t.Vector3,r=new t.Quaternion,function(){var e=h.object.position;return n.copy(e).sub(h.target),n.applyQuaternion(i),f.setFromVector3(n),h.autoRotate&&m===d.NONE&&T(2*Math.PI/60/60*h.autoRotateSpeed),f.theta+=g.theta,f.phi+=g.phi,f.theta=Math.max(h.minAzimuthAngle,Math.min(h.maxAzimuthAngle,f.theta)),f.phi=Math.max(h.minPolarAngle,Math.min(h.maxPolarAngle,f.phi)),f.makeSafe(),f.radius*=v,f.radius=Math.max(h.minDistance,Math.min(h.maxDistance,f.radius)),h.target.add(b),n.setFromSpherical(f),n.applyQuaternion(a),e.copy(h.target).add(n),h.object.lookAt(h.target),!0===h.enableDamping?(g.theta*=1-h.dampingFactor,g.phi*=1-h.dampingFactor):g.set(0,0,0),v=1,b.set(0,0,0),!!(w||s.distanceToSquared(h.object.position)>p||8*(1-r.dot(h.object.quaternion))>p)&&(h.dispatchEvent(l),s.copy(h.object.position),r.copy(h.object.quaternion),w=!1,!0)}),this.dispose=function(){h.domElement.removeEventListener("contextmenu",Y,!1),h.domElement.removeEventListener("mousedown",k,!1),h.domElement.removeEventListener("wheel",F,!1),h.domElement.removeEventListener("touchstart",V,!1),h.domElement.removeEventListener("touchend",W,!1),h.domElement.removeEventListener("touchmove",U,!1),document.removeEventListener("mousemove",I,!1),document.removeEventListener("mouseup",N,!1),window.removeEventListener("keydown",B,!1)};var h=this,l={type:"change"},c={type:"start"},u={type:"end"},d={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},m=d.NONE,p=1e-6,f=new t.Spherical,g=new t.Spherical,v=1,b=new t.Vector3,w=!1,y=new t.Vector2,x=new t.Vector2,E=new t.Vector2,_=new t.Vector2,D=new t.Vector2,M=new t.Vector2,O=new t.Vector2,j=new t.Vector2,C=new t.Vector2;function P(){return Math.pow(.95,h.zoomSpeed)}function T(e){g.theta-=e}function R(e){g.phi-=e}var A,z=(A=new t.Vector3,function(e,t){A.setFromMatrixColumn(t,0),A.multiplyScalar(-e),b.add(A)}),L=function(){var e=new t.Vector3;return function(t,o){e.setFromMatrixColumn(o,1),e.multiplyScalar(t),b.add(e)}}(),S=function(){var e=new t.Vector3;return function(t,o){var n=h.domElement===document?h.domElement.body:h.domElement;if(h.object.isPerspectiveCamera){var i=h.object.position;e.copy(i).sub(h.target);var a=e.length();a*=Math.tan(h.object.fov/2*Math.PI/180),z(2*t*a/n.clientHeight,h.object.matrix),L(2*o*a/n.clientHeight,h.object.matrix)}else h.object.isOrthographicCamera?(z(t*(h.object.right-h.object.left)/h.object.zoom/n.clientWidth,h.object.matrix),L(o*(h.object.top-h.object.bottom)/h.object.zoom/n.clientHeight,h.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),h.enablePan=!1)}}();function G(e){h.object.isPerspectiveCamera?v/=e:h.object.isOrthographicCamera?(h.object.zoom=Math.max(h.minZoom,Math.min(h.maxZoom,h.object.zoom*e)),h.object.updateProjectionMatrix(),w=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),h.enableZoom=!1)}function H(e){h.object.isPerspectiveCamera?v*=e:h.object.isOrthographicCamera?(h.object.zoom=Math.max(h.minZoom,Math.min(h.maxZoom,h.object.zoom/e)),h.object.updateProjectionMatrix(),w=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),h.enableZoom=!1)}function k(e){if(!1!==h.enabled){switch(e.preventDefault(),e.button){case h.mouseButtons.ORBIT:if(!1===h.enableRotate)return;!function(e){y.set(e.clientX,e.clientY)}(e),m=d.ROTATE;break;case h.mouseButtons.ZOOM:if(!1===h.enableZoom)return;!function(e){O.set(e.clientX,e.clientY)}(e),m=d.DOLLY;break;case h.mouseButtons.PAN:if(!1===h.enablePan)return;!function(e){_.set(e.clientX,e.clientY)}(e),m=d.PAN}m!==d.NONE&&(document.addEventListener("mousemove",I,!1),document.addEventListener("mouseup",N,!1),h.dispatchEvent(c))}}function I(e){if(!1!==h.enabled)switch(e.preventDefault(),m){case d.ROTATE:if(!1===h.enableRotate)return;!function(e){x.set(e.clientX,e.clientY),E.subVectors(x,y);var t=h.domElement===document?h.domElement.body:h.domElement;T(2*Math.PI*E.x/t.clientWidth*h.rotateSpeed),R(2*Math.PI*E.y/t.clientHeight*h.rotateSpeed),y.copy(x),h.update()}(e);break;case d.DOLLY:if(!1===h.enableZoom)return;!function(e){j.set(e.clientX,e.clientY),C.subVectors(j,O),C.y>0?G(P()):C.y<0&&H(P()),O.copy(j),h.update()}(e);break;case d.PAN:if(!1===h.enablePan)return;!function(e){D.set(e.clientX,e.clientY),M.subVectors(D,_),S(M.x,M.y),_.copy(D),h.update()}(e)}}function N(e){!1!==h.enabled&&(document.removeEventListener("mousemove",I,!1),document.removeEventListener("mouseup",N,!1),h.dispatchEvent(u),m=d.NONE)}function F(e){!1===h.enabled||!1===h.enableZoom||m!==d.NONE&&m!==d.ROTATE||(e.preventDefault(),e.stopPropagation(),function(e){e.deltaY<0?H(P()):e.deltaY>0&&G(P()),h.update()}(e),h.dispatchEvent(c),h.dispatchEvent(u))}function B(e){!1!==h.enabled&&!1!==h.enableKeys&&!1!==h.enablePan&&function(e){switch(e.keyCode){case h.keys.UP:S(0,h.keyPanSpeed),h.update();break;case h.keys.BOTTOM:S(0,-h.keyPanSpeed),h.update();break;case h.keys.LEFT:S(h.keyPanSpeed,0),h.update();break;case h.keys.RIGHT:S(-h.keyPanSpeed,0),h.update()}}(e)}function V(e){if(!1!==h.enabled){switch(e.touches.length){case 1:if(!1===h.enableRotate)return;!function(e){y.set(e.touches[0].pageX,e.touches[0].pageY)}(e),m=d.TOUCH_ROTATE;break;case 2:if(!1===h.enableZoom)return;!function(e){var t=e.touches[0].pageX-e.touches[1].pageX,o=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+o*o);O.set(0,n)}(e),m=d.TOUCH_DOLLY;break;case 3:if(!1===h.enablePan)return;!function(e){_.set(e.touches[0].pageX,e.touches[0].pageY)}(e),m=d.TOUCH_PAN;break;default:m=d.NONE}m!==d.NONE&&h.dispatchEvent(c)}}function U(e){if(!1!==h.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(!1===h.enableRotate)return;if(m!==d.TOUCH_ROTATE)return;!function(e){x.set(e.touches[0].pageX,e.touches[0].pageY),E.subVectors(x,y);var t=h.domElement===document?h.domElement.body:h.domElement;T(2*Math.PI*E.x/t.clientWidth*h.rotateSpeed),R(2*Math.PI*E.y/t.clientHeight*h.rotateSpeed),y.copy(x),h.update()}(e);break;case 2:if(!1===h.enableZoom)return;if(m!==d.TOUCH_DOLLY)return;!function(e){var t=e.touches[0].pageX-e.touches[1].pageX,o=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+o*o);j.set(0,n),C.subVectors(j,O),C.y>0?H(P()):C.y<0&&G(P()),O.copy(j),h.update()}(e);break;case 3:if(!1===h.enablePan)return;if(m!==d.TOUCH_PAN)return;!function(e){D.set(e.touches[0].pageX,e.touches[0].pageY),M.subVectors(D,_),S(M.x,M.y),_.copy(D),h.update()}(e);break;default:m=d.NONE}}function W(e){!1!==h.enabled&&(h.dispatchEvent(u),m=d.NONE)}function Y(e){!1!==h.enabled&&e.preventDefault()}h.domElement.addEventListener("contextmenu",Y,!1),h.domElement.addEventListener("mousedown",k,!1),h.domElement.addEventListener("wheel",F,!1),h.domElement.addEventListener("touchstart",V,!1),h.domElement.addEventListener("touchend",W,!1),h.domElement.addEventListener("touchmove",U,!1),window.addEventListener("keydown",B,!1),this.update()}l.prototype=Object.create(t.EventDispatcher.prototype),l.prototype.constructor=l,Object.defineProperties(l.prototype,{center:{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(e){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(e){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!e}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(e){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(e){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=e}}});class c{constructor(e){this.__raycaster=new t.Raycaster,this.__mouse=new t.Vector2,this.__resize=e.__proto__._onResize,this.__mousemove=e.__proto__._onMouseMove,this.__mousedown=e.__proto__._onMouseDown,this.target=e,Object.assign(this,e),this.camera||this.renderer||this.el?this.__resize||this.__mousemove||this.__mousedown?(this.__resize__=this.onWindowResize.bind(this),this.__mousemove__=this.onDocumentMouseMove.bind(this),this.__touchstart__=this.onDocumentTouchStart.bind(this),this.__mousedown__=this.onDocumentMouseDown.bind(this),this.mousemove_timer=null,this.mousemove_interval=10,this.enable=!0,this.__resize&&window.addEventListener("resize",this.__resize__,!1),this.__mousemove&&this.el.addEventListener("mousemove",this.__mousemove__,!1),this.__mousedown&&(this.el.addEventListener("touchstart",this.__touchstart__,!1),this.el.addEventListener("mousedown",this.__mousedown__,!1))):console.warn("THREE.Event:Users need to implement _onResize(),_onMouseMove(),_onMouseDown() method"):console.warn("THREE.Event:not find camera, renderer, domElement,Please ensure that it is a valid 3D control")}dispose(){window.removeEventListener("resize",this.__resize__,!1),this.el.removeEventListener("mousemove",this.__mousemove__,!1),this.el.removeEventListener("touchstart",this.__touchstart__,!1),this.el.removeEventListener("mousedown",this.__mousedown__,!1)}onWindowResize(e){this.camera.aspect=this.el.offsetWidth/this.el.offsetHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.el.offsetWidth,this.el.offsetHeight),this.enable&&this.__resize.bind(this.target)(e)}onDocumentMouseMove(e){e.preventDefault(),this.mousemove_timer&&clearTimeout(this.mousemove_timer),this.mousemove_timer=setTimeout(()=>{this.__mouse.x=e.offsetX/this.el.offsetWidth*2-1,this.__mouse.y=-e.offsetY/this.el.offsetHeight*2+1,this.__raycaster.setFromCamera(this.__mouse,this.camera);let t=this.__raycaster.intersectObjects(this.scene.children,!0);this.enable&&this.__mousemove.bind(this.target)(e,t)},this.mousemove_interval)}onDocumentTouchStart(e){e.preventDefault(),e.clientX=e.touches[0].pageX,e.clientY=e.touches[0].pageY,this.enable&&this.onDocumentMouseDown(e)}onDocumentMouseDown(e){e.preventDefault(),this.__mouse.x=(e.offsetX||e.clientX)/this.el.offsetWidth*2-1,this.__mouse.y=-(e.offsetY||e.clientY)/this.el.offsetHeight*2+1,this.__raycaster.setFromCamera(this.__mouse,this.camera);let t=this.__raycaster.intersectObjects(this.scene.children,!0);this.enable&&this.__mousedown.bind(this.target)(e,t)}}var u=function(){var e=Date.now(),t=e,o=0,n=1/0,i=0,a=0,s=1/0,r=0,h=0,l=0,c=document.createElement("div");c.id="stats",c.addEventListener("mousedown",function(e){e.preventDefault(),b(++l%2)},!1),c.style.cssText="width:80px;opacity:0.9;cursor:pointer";var u=document.createElement("div");u.id="fps",u.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#002",c.appendChild(u);var d=document.createElement("div");d.id="fpsText",d.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",d.innerHTML="FPS",u.appendChild(d);var m=document.createElement("div");for(m.id="fpsGraph",m.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff",u.appendChild(m);m.children.length<74;){(v=document.createElement("span")).style.cssText="width:1px;height:30px;float:left;background-color:#113",m.appendChild(v)}var p=document.createElement("div");p.id="ms",p.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none",c.appendChild(p);var f=document.createElement("div");f.id="msText",f.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",f.innerHTML="MS",p.appendChild(f);var g=document.createElement("div");for(g.id="msGraph",g.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0",p.appendChild(g);g.children.length<74;){var v;(v=document.createElement("span")).style.cssText="width:1px;height:30px;float:left;background-color:#131",g.appendChild(v)}var b=function(e){switch(l=e){case 0:u.style.display="block",p.style.display="none";break;case 1:u.style.display="none",p.style.display="block"}},w=function(e,t){e.appendChild(e.firstChild).style.height=t+"px"};return{REVISION:11,domElement:c,setMode:b,begin:function(){e=Date.now()},end:function(){var l=Date.now();return o=l-e,n=Math.min(n,o),i=Math.max(i,o),f.textContent=o+" MS ("+n+"-"+i+")",w(g,Math.min(30,30-o/200*30)),h++,l>t+1e3&&(a=Math.round(1e3*h/(l-t)),s=Math.min(s,a),r=Math.max(r,a),d.textContent=a+" FPS ("+s+"-"+r+")",w(m,Math.min(30,30-a/100*30)),t=l,h=0),l},update:function(){e=this.end()}}};t.ShaderLib.line={uniforms:{amplitude:{value:1},color:{value:16777215},texture:{value:null}},vertexShader:["uniform float amplitude;","attribute float size;","attribute vec3 customColor;","varying vec3 vColor;","void main() {","vColor = customColor;","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","gl_PointSize = size;","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D texture;","varying vec3 vColor;","void main() {","gl_FragColor = vec4( color * vColor, 1.0 );","gl_FragColor = gl_FragColor * texture2D( texture, gl_PointCoord );","}"].join("\n")},t.ShaderLib.edgelight={uniforms:{s:{type:"f",value:-1},b:{type:"f",value:1},p:{type:"f",value:2},glowColor:{type:"c",value:new t.Color(65535)}},vertexShader:["varying vec3 vNormal;","varying vec3 vPositionNormal;","void main() {","vNormal = normalize( normalMatrix * normal ); ","vPositionNormal = normalize(( modelViewMatrix * vec4(position, 1.0) ).xyz);","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 glowColor;","uniform float p;","uniform float b;","uniform float s;","varying vec3 vNormal;","varying vec3 vPositionNormal;","void main() ","{","  float a = pow( b + s * abs(dot(vNormal, vPositionNormal)), p );","  gl_FragColor = vec4( glowColor, a );","}"].join("\n")},t.ShaderLib.createShaderMaterial=function(e,o,n){return new t.ShaderMaterial({uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,side:o||t.FrontSide,blending:n||t.AdditiveBlending,transparent:!0})},console.log(t.ShaderLib);class d extends t.Object3D{constructor(e){super(e),this.type="Area",this.name=e.name,Object.assign(this.userData,e);let t=e.coords;this._mesh=this.getMesh(t,e),this._line=this.getLine(t,e),this.add(this._mesh),this.add(this._line),e.showText&&(this._text=this.getText(e),this.add(this._text)),e.loadEffect&&(this.setPosition({x:0,y:-40,z:-1e3}),this.setPosition({x:0,y:0,z:0},500,10*d.count,i.Easing.Quartic.Out)),d.count++}getText(e){if(!e.cp)return;let t=new h(e.name,e.textStyle);return t.position.set(e.cp[0],e.cp[1],e.extrudeHeight+.01),t}getMesh(e,o){if(e)try{let n=new t.Geometry;return e.forEach(e=>{let t=this.getGeoPoints(e),o=this.getExtrudeGeometry(t);n.merge(o,o.matrix)}),this.getGeoMesh(n,o)}catch(e){console.warn("Area.getMesh:"+e.message)}}getLine(e,o){if(!e)return;let n=new t.LineBasicMaterial({opacity:this.userData.lineOpacity,transparent:this.userData.lineOpacity<1,linewidth:1,polygonOffset:!0,polygonOffsetFactor:1,color:this.userData.lineColor}),i=new t.Group;return e.forEach(e=>{let o=this.getGeoPoints(e),a=new t.Geometry;for(let e=0,n=o.length;e<n;e++)a.vertices.push(new t.Vector3(o[e].x,o[e].y,this.userData.extrude.amount+this.userData.extrude.amount/100));let s=new t.Line(a,n);i.add(s)}),i}getGeoPoints(e){try{let o=[];for(let n=0,i=e.length;n<i;n++)o.push(new t.Vector2(e[n][0],e[n][1]));return o}catch(t){console.log("getGeoPoints:parse coord error:"+JSON.stringify(e))}}getExtrudeGeometry(e){let o=new t.Shape(e),n=Object.assign({},this.userData.extrude);return new t.ExtrudeGeometry(o,n)}getGeoMesh(e,o){let n={};n.color=null!=o.color?a(o.color):16777215*Math.random(),n.shininess=o.shininess||100,n.transparent=!0,n.opacity=void 0===o.opacity?this.userData.opacity:o.opacity,e.computeFlatVertexNormals();let i=null;return this.update=function(){},i=this.userData.hasPhong?new t.Mesh(e,new t.MeshPhongMaterial(n)):new t.Mesh(e,new t.MeshLambertMaterial(n))}get mesh(){return this._mesh}get line(){return this._line}setColor(e,o,n,i,r){this.userData.color=a(e),o&&"number"==typeof o?(e=new t.Color(a(e)),s(this.mesh.material.color,e,o,n,i,r)):this.mesh.material.color.set(a(e))}setPosition(e,t,o,n,i){t&&"number"==typeof t?s(this.position,e,t,o,n,i):this.position.set(e.x,e.y,e.z)}setRotation(e,t,o,n,i){e.x=e.x*(Math.PI/180),e.y=e.y*(Math.PI/180),e.z=e.z*(Math.PI/180),s(this.rotation,e,t,o,n,i)}setScale(e,t,o,n){t&&"number"==typeof t?s(this.scale,e,t,o,easing,callback):this.scale.set(e.x,e.y,e.z)}onmouseout(e,o){this.userData.hasHoverHeight&&new i.Tween(this.position).to({z:0},this.userData.hoverAnimaTime).start(),new i.Tween(this.mesh.material.color).to(new t.Color(a(this.userData.color)),this.userData.hoverAnimaTime).start(),e.dispatchEvent({type:"mouseout",target:this,orgEvent:o})}onmouseover(e,o){this.userData.hasHoverHeight&&new i.Tween(this.position).to({z:this.userData.extrude.amount/2},this.userData.hoverAnimaTime).start(),new i.Tween(this.mesh.material.color).to(new t.Color(a(this.userData.hoverColor)),this.userData.hoverAnimaTime).start(),e.dispatchEvent({type:"mouseover",target:this,orgEvent:o})}onmousedown(e,t){e.dispatchEvent({type:"mousedown",target:this,orgEvent:t})}}d.count=0;class m extends t.Object3D{constructor(e){super(e),this.type="DataRange",this.name=e.name,Object.assign(this.userData,e);let o=new t.BoxGeometry(e.width,e.height,e.extrudeHeight),n=new t.MeshPhongMaterial({color:e.color}),i=new t.Mesh(o,n);if(this.position.y=this.position.y-m.count*(e.height+e.spacing),e.showName){let t=Font3D.create(e.name,{color:"#ffffff"});t.position.copy(i.position),t.position.y=t.position.y-.3,t.position.add(e.namePosition),this.add(t),this.txt=t}this.mesh=i,this.add(i),m.count++}select(){return this.rangeAreas.map(e=>{e.setColor(this.userData.hoverColor),e.userData.hasHoverHeight&&new i.Tween(e.position).to({z:e.userData.extrude.amount/2},e.userData.hoverAnimaTime).start()})}unselect(){this.rangeAreas.map(e=>{e.setColor(this.userData.color),e.userData.hasHoverHeight&&new i.Tween(e.position).to({z:0},e.userData.hoverAnimaTime).start()})}onmouseout(e,o){this.unselect(),new i.Tween(this.mesh.material.color).to(new t.Color(a(this.userData.color)),this.userData.hoverAnimaTime).start(),this.userData.hasEvent&&e.dispatchEvent({type:"mouseout",target:this,orgEvent:o})}onmouseover(e,o){this.select(),new i.Tween(this.mesh.material.color).to(new t.Color(a(this.userData.hoverColor)),this.userData.hoverAnimaTime).start(),this.userData.hasEvent&&e.dispatchEvent({type:"mouseover",target:this,orgEvent:o})}onmousedown(e,t){this.userData.hasEvent&&e.dispatchEvent({type:"mousedown",target:this,orgEvent:t})}}m.count=0;class p extends t.Sprite{static get texture(){if(!p._texture){let e=document.createElement("canvas");e.width=128,e.height=128;let o=e.getContext("2d");p.draw(o);let n=new t.Texture(e);n.needsUpdate=!0,p._texture=n}return p._texture}static draw(e,t){t=t||1,e.clearRect(0,0,128,128),e.fillStyle="#ffffff",e.arc(64,64,20,0,2*Math.PI,!1),e.fill(),e.fillStyle="rgba(255,255,255,.5)",e.arc(64,64,60*t,0,2*Math.PI,!1),e.fill()}constructor(e){super(),this.material=new t.SpriteMaterial({map:p.texture,color:e.color,blending:t.AdditiveBlending}),this.type="Mark",this.name=e.name,Object.assign(this.userData,e);let o=e.size||this.userData.min;o=(o=o<this.userData.min?this.userData.min:o)>this.userData.max?this.userData.max:o,this.userData.size=o,this.scale.set(o,o,1),this.position.x=e.coord[0],this.position.y=e.coord[1],this.position.z=2+35*o/100,this.update=function(){},p.count++}setColor(e,o,n,i,r){this.userData.color=a(e),o&&"number"==typeof o?(e=new t.Color(a(e)),s(this.material.color,e,o,n,i,r)):this.material.color.set(a(e))}setPosition(e,t,o,n,i){t&&"number"==typeof t?s(this.position,e,t,o,n,i):this.position.set(e.x,e.y,e.z)}setRotation(e,t,o,n,i){e.x=e.x*(Math.PI/180),e.y=e.y*(Math.PI/180),e.z=e.z*(Math.PI/180),s(this.rotation,e,t,o,n,i)}setScale(e,t,o,n,i){t&&"number"==typeof t?s(this.scale,e,t,o,n,i):this.scale.set(e.x,e.y,e.z)}onmouseout(e,o){let n=1*this.userData.size;new i.Tween(this.scale).to({x:n,y:n},this.userData.hoverAnimaTime).start(),new i.Tween(this.material.color).to(new t.Color(a(this.userData.color)),this.userData.hoverAnimaTime).start(),e.dispatchEvent({type:"mouseout",target:this,orgEvent:o})}onmouseover(e,o){let n=1.5*this.userData.size;new i.Tween(this.scale).to({x:n,y:n},this.userData.hoverAnimaTime).start(),new i.Tween(this.material.color).to(new t.Color(a(this.userData.hoverColor)),this.userData.hoverAnimaTime).start(),e.dispatchEvent({type:"mouseover",target:this,orgEvent:o})}onmousedown(e,t){e.dispatchEvent({type:"mousedown",target:this,orgEvent:t})}}p.count=0,p._texture=null;class f extends t.Line{static get texture(){if(!f._texture){let e=document.createElement("canvas");e.width=128,e.height=128;let o=e.getContext("2d");f.draw(o);let n=new t.Texture(e);n.needsUpdate=!0,f._texture=n}return f._texture}static draw(e){e.clearRect(0,0,128,128),e.fillStyle="#ffffff",e.arc(64,64,20,0,2*Math.PI,!1),e.fill(),e.fillStyle="rgba(255,255,255,.7)",e.arc(64,64,60,0,2*Math.PI,!1),e.fill()}constructor(e){let o=e.coords[0],n=e.coords[1],i=o[0],a=o[1],s=n[0],r=n[1],h=s-i,l=r-a,c=Math.pow(h*h+l*l,.5),u=[new t.Vector3(i,a,e.extrudeHeight),new t.Vector3((i+s)/2,(a+r)/2,e.extrudeHeight+e.spaceHeight),new t.Vector3(s,r,e.extrudeHeight)],d=new t.QuadraticBezierCurve3(...u);var m=new t.Geometry,p=(c+.1)*e.haloDensity;p<30&&(p=30),m.vertices=d.getPoints(p).reverse(),m.vertices.forEach(()=>{m.colors.push(new t.Color(16777215))});let g=new t.LineBasicMaterial({color:e.color,opacity:1,blending:t.AdditiveBlending,transparent:!0,depthWrite:!1,vertexColors:!0,linewidth:1});super(m,g),Object.assign(this.userData,e),e.hasHalo&&this.initHalo(m),this.index=f.count++,f.array.push(this)}initHalo(e){let o=this,n=e.vertices.length,i=new Float32Array(3*n),s=new Float32Array(3*n),r=new Float32Array(n),h=new t.Vector3,l=new t.Color(a(this.userData.color));for(let t=0;t<n;t++)h.x=e.vertices[t].x,h.y=e.vertices[t].y,h.z=e.vertices[t].z,h.toArray(i,3*t),l.toArray(s,3*t),r[t]=o.userData.haloSize;let c=new t.BufferGeometry;c.addAttribute("position",new t.BufferAttribute(i,3)),c.addAttribute("customColor",new t.BufferAttribute(s,3)),c.addAttribute("size",new t.BufferAttribute(r,1));let u=t.ShaderLib.line;u.uniforms={amplitude:{value:1},color:{value:new t.Color(a(this.userData.haloColor))},texture:{value:f.texture}};let d=new t.ShaderMaterial({uniforms:u.uniforms,vertexShader:u.vertexShader,fragmentShader:u.fragmentShader,blending:t.AdditiveBlending,depthTest:!0,depthWrite:!1,transparent:!0}),m=new t.Points(c,d);m.dynamic=!0,this.add(m),this.halo=m,m.update=function(){if(!o.userData.hasHalo||!o.userData.hasHaloAnimate)return;let e=.005*Date.now()+3*o.index,t=this.geometry.attributes;for(let n=0;n<t.size.array.length;n++)t.size.array[n]=o.userData.haloSize+o.userData.haloSize*Math.sin(o.userData.haloRunRate*n+e);t.size.needsUpdate=!0}}update(){this.halo.update()}setColor(e,o){void 0!==e&&(this.material.color=new t.Color(a(e)))}setLineWidth(e){this.userData.hasHalo||console.warn("Setting the LineWidth must be hasHalo:true"),this.userData.haloSize=e}onmouseout(e,t){if(this.userData.hoverExclusive&&f.array.map(e=>{e.halo&&(e.halo.visible=!0),e.setColor(e.userData.color)}),this.userData.hasHalo){let e=this.userData.haloSize/1.5;this.userData.haloSize=e}this.setColor(this.userData.color),e.dispatchEvent({type:"mouseout",target:this,orgEvent:t})}onmouseover(e,t){if(this.userData.hoverExclusive&&f.array.map(e=>{e.halo&&(e.halo.visible=!1),e.setColor(this.userData.decayColor)}),this.userData.hasHalo){let e=1.5*this.userData.haloSize;this.userData.haloSize=e,this.halo.visible=!0}this.setColor(this.userData.hoverColor?this.userData.hoverColor:this.userData.color),e.dispatchEvent({type:"mouseover",target:this,orgEvent:t})}onmousedown(e,t){e.dispatchEvent({type:"mousedown",target:this,orgEvent:t})}}f.count=0,f.array=[],f._texture=null;class g extends t.Object3D{constructor(e){super();let o=e.texture||(new t.TextureLoader).load(e.url);this.material=new t.MeshStandardMaterial({color:e.color,emissive:e.emissive||0,transparent:!0,opacity:e.opacity,blending:e.additiveBlending?t.AdditiveBlending:t.NormalBlending,side:t.DoubleSide,map:o||null,alphaMap:e.useAlphaMap?o:null,depthTest:e.depthTest}),this.type="Bar",this.name=e.name,Object.assign(this.userData,e),this.geometry="box"===e.barType?new t.BoxGeometry(e.size,e.size,e.value):new t.CylinderGeometry(e.size,e.size,e.value,32),this.add(new t.Mesh(this.geometry,this.material)),this.position.x=e.coord[0],this.position.y=e.coord[1],this.position.z=e.extrudeHeight+e.value/2,"box"!==e.barType&&(this.rotation.x=Math.PI/180*-90),this.update=function(){},g.count++}setColor(e,o,n,i,r){this.userData.color=a(e),o&&"number"==typeof o?(e=new t.Color(a(e)),s(this.material.color,e,o,n,i,r)):this.material.color.set(a(e))}setPosition(e,t,o,n,i){t&&"number"==typeof t?s(this.position,e,t,o,n,i):this.position.set(e.x,e.y,e.z)}setRotation(e,t,o,n,i){e.x=e.x*(Math.PI/180),e.y=e.y*(Math.PI/180),e.z=e.z*(Math.PI/180),s(this.rotation,e,t,o,n,i)}setScale(e,t,o,n,i){t&&"number"==typeof t?s(this.scale,e,t,o,n,i):this.scale.set(e.x,e.y,e.z)}onmouseout(e,o){new i.Tween(this.material.emissive).to(new t.Color(a(this.userData.emissive)),this.userData.hoverAnimaTime).start(),e.dispatchEvent({type:"mouseout",target:this,orgEvent:o})}onmouseover(e,o){console.log(this.userData),new i.Tween(this.material.emissive).to(new t.Color(a(this.userData.hoverColor)),this.userData.hoverAnimaTime).start(),e.dispatchEvent({type:"mouseover",target:this,orgEvent:o})}onmousedown(e,t){e.dispatchEvent({type:"mousedown",target:this,orgEvent:t})}}g.count=0,g._texture=null;var v={amount:1,bevelThickness:1,bevelSize:.2,bevelEnabled:!1,bevelSegments:5,curveSegments:1,steps:1};Object.assign(t.EventDispatcher.prototype,{dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){let a=e.target;for(let t in e.orgEvent)e[t]=e.orgEvent[t];e.target=a||this;for(var o=t.slice(0),n=0,i=o.length;n<i;n++)o[n].call(this,e)}}}}),Object.assign(class{constructor(e){if(!o.webgl)return void console.warn("不支持webgl,停止渲染.");let t={name:"",el:document.body,geoData:null,hasStats:!0,hasControls:!0,autoRotate:!1,ambientColor:3355443,directionalColor:16777215,hasLoadEffect:!1,debugger:!1,cameraPosition:{x:0,y:0,z:40},extrude:v,area:{data:[],name:"",color:3368703,hoverColor:16750899,lineColor:16777215,lineOpacity:1,opacity:1,hasPhong:!0,shininess:50,hoverAnimaTime:300,loadEffect:!1,hasHoverHeight:!0,showText:!1,textStyle:{size:50,color:"#ffffff",borderColor:"#000000"}},dataRange:{data:[],width:1,height:.7,position:{x:23,y:-8,z:1},spacing:.2,text:["高","低"],textColor:"#ffffff",showName:!1,namePosition:{x:-2,y:0,z:0},hoverColor:16750899,hoverAnimaTime:100,hasHoverHeight:!0,hasEvent:!0},mark:{data:[],name:"",color:16777215,hoverColor:16750899,hoverAnimaTime:100,min:.01,max:5},bar:{data:[],name:"",color:16777215,hoverColor:16750899,hoverAnimaTime:100,size:1,value:1},line:{data:[],color:5631743,hoverColor:16750899,hoverExclusive:!0,hoverAnimaTime:100,spaceHeight:5,hasHalo:!0,hasHaloAnimate:!0,haloDensity:2,haloRunRate:.01,haloColor:16777215,haloSize:10,decayColor:2236962},mapObject:null,areaGroup:null,lineGroup:null,markGroup:null,scene:null,camera:null,renderer:null,stats:null,controls:null,areaCount:0,_w:0,_h:0,__event:null};r(!0,t,e),r(!0,this,t),this.geoData?(this._w=this.el.offsetWidth,this._h=this.el.offsetHeight,console.time("init"),this.init(),console.timeEnd("init"),this.initEvent()):console.warn("Map3D no geoData.")}init(){this.el.innerHTML="",this.scene=new t.Scene({antialias:!0}),this.camera=new t.PerspectiveCamera(70,this._w/this._h,.1,1e3),this.renderer=new t.WebGLRenderer({alpha:!0}),this.renderer.setPixelRatio(window.devicePixelRatio),this.camera.position.set(this.cameraPosition.x,this.cameraPosition.y,this.cameraPosition.z),this.camera.lookAt(this.scene.position),this.renderer.setSize(this._w,this._h),this.scene.fog=new t.Fog(16777215,.15,1e3),this.scene.add(new t.AmbientLight(a(this.ambientColor))),this.dirLight=new t.DirectionalLight(a(this.directionalColor)),this.dirLight.position.set(0,50,50),this.scene.add(this.dirLight),this.dirLightDown=new t.DirectionalLight(a(this.directionalColor)),this.dirLightDown.position.set(0,-50,0),this.scene.add(this.dirLightDown),this.spotLight=new t.SpotLight(a(this.color)),this.spotLight.position.set(0,150,150),this.spotLight.intensity=.7,this.spotLight.target=this.scene,this.scene.add(this.spotLight),this.mapObject=new t.Group,this.initControls(),this.initDebug(),console.time("initArea"),this.initArea(),console.timeEnd("initArea"),console.time("initMark"),this.initMark(),console.timeEnd("initMark"),console.time("initLine"),this.initLine(),console.timeEnd("initLine"),console.time("inintDataRange"),this.inintDataRange(),console.timeEnd("inintDataRange"),console.time("initBar"),this.initBar(),console.timeEnd("initBar"),this.geoData.cp&&this.mapObject.position.set(-this.geoData.cp[0],-this.geoData.cp[1],0),this.scene.add(this.mapObject),this.scene.add(this.camera),this.el.appendChild(this.renderer.domElement),this.renderScene()}initArea(e){Object.assign(this.area,e),d.count=0,this.areaGroup&&this.areaGroup.remove(...this.areaGroup.children),this.areaGroup=new t.Group,this.geoData.features.forEach(e=>{let t=this.area.data.find(t=>t.name===e.properties.name);Object.assign(e.properties,t),this.createArea(e)}),this.mapObject.add(this.areaGroup)}inintDataRange(e){Object.assign(this.dataRange,e);let o=Object.assign({extrudeHeight:this.extrude.amount/2},this.dataRange);if(delete o.data,this.dataRangeGroup&&this.dataRangeGroup.remove(...this.dataRangeGroup.children),m.count=0,this.dataRangeGroup=new t.Group,this.dataRange.data.forEach(e=>{let t=Object.assign({},o,e),n=new m(t);n.rangeAreas=[],this.dataRangeGroup.add(n);let i=void 0===e.min?-999999999999:e.min,a=void 0===e.max?999999999999:e.max,s=null;this.area.data.forEach(t=>{void 0!==t.value&&i<t.value&&t.value<a&&(s=this.getArea(t.name))&&(n.rangeAreas.push(s),s.setColor(e.color))})}),this.dataRange.data.length>0){if(this.dataRange.text[0]){let e=new h(this.dataRange.text[0],{color:this.dataRange.textColor});e.position.add({x:0,y:1,z:0}),this.dataRangeGroup.add(e)}if(this.dataRange.text[1]){let e=new h(this.dataRange.text[1],{color:this.dataRange.textColor});e.position.add({x:0,y:-(this.dataRange.height+m.count*(this.dataRange.height+this.dataRange.spacing)),z:0}),this.dataRangeGroup.add(e)}}this.dataRangeGroup.position.add(this.dataRange.position),this.scene.add(this.dataRangeGroup)}initMark(e){Object.assign(this.mark,e);let o=Object.assign({extrudeHeight:this.extrude.amount},this.mark);delete o.data,p.count=0,this.markGroup&&this.markGroup.remove(...this.markGroup.children),this.markGroup=new t.Group,this.mark.data.forEach(e=>{let t=Object.assign({},o,e),n=new p(t);this.markGroup.add(n)}),this.mapObject.add(this.markGroup)}initLine(e){Object.assign(this.line,e);let o=Object.assign({extrudeHeight:this.extrude.amount},this.line);delete o.data,f.count=0,this.lineGroup&&this.lineGroup.remove(...this.lineGroup.children),this.lineGroup=new t.Group,this.line.data.forEach(e=>{let t=Object.assign({},o,e),n=new f(t);this.lineGroup.add(n)}),this.mapObject.add(this.lineGroup)}initBar(e){Object.assign(this.bar,e);let o=Object.assign({extrudeHeight:this.extrude.amount},this.bar);delete o.data,g.count=0,this.barGroup&&this.barGroup.remove(...this.barGroup.children),this.barGroup=new t.Group,this.bar.data.forEach(e=>{let t=Object.assign({},o,e),n=new g(t);this.barGroup.add(n)}),this.mapObject.add(this.barGroup)}addCameraPosition(e,o,n,a){let s=new t.Vector3(e.x,e.y,e.z);if("number"==typeof o){let e=this.camera.position.clone().add(s);a||(a=(()=>{})),new i.Tween(this.camera.position).to(e,o).delay(n||0).start().onComplete(a)}else this.camera.position.add(e.x,e.y,e.z)}setCameraPosition(e,t,o,n,i){t&&"number"==typeof t?s(this.camera.position,e,t,o,n,i):this.camera.position.set(e.x,e.y,e.z)}dispose(){this.el.innerHTML="",this.__event.dispose()}disable(e){(e=void 0===e||e)?(this.el.style.pointerEvents="none",this.__event.enable=!e):(this.el.style.pointerEvents="",this.__event.enable=!e)}initEvent(){this.__event=new c(this)}initControls(){if(this.hasControls)return this.controls=new l(this.camera,this.renderer.domElement),this.controls.userPan=!1,this.controls.autoRotate=this.autoRotate,this.controls.userPanSpeed=1,this.controls}initStats(){return this.stats=new u,this.stats.setMode(0),this.stats.domElement.style.position="absolute",this.stats.domElement.style.top="70px",this.stats.domElement.style.right="0px",this.el.appendChild(this.stats.domElement),this.stats}initDebug(){if(!this.debugger)return;this.name&&(window[this.name]=this),this.initStats();let e=new t.DirectionalLightHelper(this.dirLight,5);this.scene.add(e);let o=new t.SpotLightHelper(this.spotLight);this.scene.add(o);let n=new t.GridHelper(300,40);this.scene.add(n);let i=new t.AxisHelper(50);this.scene.add(i),this.infoPlane=document.createElement("div"),this.infoPlane.contentEditable=!0,this.infoPlane.style.position="absolute",this.infoPlane.style.bottom="70px",this.infoPlane.style.right="10px",this.infoPlane.style.padding="5px 10px",this.infoPlane.style.background="rbga(0,0,0,.5)",this.infoPlane.style.border="1px solid #aaa",this.infoPlane.style.borderRadius="5px",this.infoPlane.style.color="#eee",this.el.appendChild(this.infoPlane)}printCameraPosition(){let e=this.camera.position;this.infoPlane.textContent="相机位置 {x:"+e.x.toFixed(4)+",y:"+e.y.toFixed(4)+",z:"+e.z.toFixed(4)+"}"}reomveArea(e){"string"==typeof e&&(e=this.getArea(e)),this.areaGroup.remove(e)}removeMark(e){"string"==typeof e&&(e=this.getMark(e)),this.markGroup.remove(e)}getArea(e){return this.areaGroup.getObjectByName(e)}getMark(e){return this.markGroup.getObjectByName(areaName)}getObjectsByName(e){let t=[];return this.scene.traverse(o=>{o.name===e&&t.push(o)}),t}renderScene(){this.renderer.clear(),requestAnimationFrame(this.renderScene.bind(this)),this.areaGroup.children.map(e=>{e&&e.update()}),this.lineGroup.children.map(e=>{e.halo&&e.halo.update()}),this.markGroup.children.map(e=>{e.update()}),i.update(),this.hasControls&&this.controls.update(),this.debugger&&(this.stats.update(),this.printCameraPosition()),this.renderer.render(this.scene,this.camera)}_onResize(){this.dispatchEvent({type:"resize",el:null})}_onMouseMove(e,t){if(t.length>0){let o=this.selectedObj?this.selectedObj.id:"";this.selectedObj=null;for(let e=0;e<t.length;e++){if(t[e].object&&"Mesh"===t[e].object.type&&t[e].object.parent.type&&"Area"===t[e].object.parent.type){this.selectedObj=t[e].object.parent;break}if(t[e].object&&"Mark"===t[e].object.type){this.selectedObj=t[e].object;break}if(t[e].object&&t[e].object.parent==this.lineGroup&&"Line"===t[e].object.type){this.selectedObj=t[e].object;break}if(t[e].object&&t[e].object.parent&&"DataRange"===t[e].object.parent.type){this.selectedObj=t[e].object.parent;break}if(t[e].object&&t[e].object.parent&&"Bar"===t[e].object.parent.type){this.selectedObj=t[e].object.parent;break}}if(this.selectedObj){if(o!=this.selectedObj.id){if(o){let t=this.scene.getObjectById(o);t&&t.onmouseout(this,e)}this.selectedObj.onmouseover(this,e)}}else if(o){let t=this.scene.getObjectById(o);t&&t.onmouseout(this,e)}}else this.selectedObj&&this.selectedObj.onmouseout(this,e),this.selectedObj=null}_onMouseDown(e,t){if(t.length>0){let o=null;for(let e=0;e<t.length;e++){if(t[e].object&&"Mesh"==t[e].object.type&&t[e].object.parent.type&&"Area"==t[e].object.parent.type){o=t[e].object.parent;break}if(t[e].object&&"Mark"===t[e].object.type){o=t[e].object;break}if(t[e].object&&t[e].object.parent&&"DataRange"===t[e].object.parent.type){o=t[e].object.parent;break}}o&&(this.debugger&&console.log(o),o.onmousedown(this,e))}}createArea(e){let t=Object.assign({color:this.area.color,hoverColor:this.area.hoverColor,lineColor:this.area.lineColor,lineOpacity:this.area.lineOpacity,opacity:this.area.opacity,hasPhong:this.area.hasPhong,shininess:this.area.shininess,hoverAnimaTime:this.area.hoverAnimaTime,extrude:this.extrude,loadEffect:this.area.loadEffect,hasHoverHeight:this.area.hasHoverHeight,showText:this.area.showText,textStyle:this.area.textStyle,extrudeHeight:this.extrude.amount},e.properties),o=[];if(!e.geometry)return;if("Polygon"==e.geometry.type)o.push(e.geometry.coordinates[0]);else if("MultiPolygon"==e.geometry.type)for(var n=0;n<e.geometry.coordinates.length;n++)o.push(e.geometry.coordinates[n][0]);t.coords=o;let i=new d(t);this.areaGroup.add(i)}}.prototype,t.EventDispatcher.prototype),e.Area=d,e.Line=f,e.Mark=p,Object.defineProperty(e,"__esModule",{value:!0})});
